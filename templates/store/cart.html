{% extends "base.html" %}
{% block content %}
    <main>
        <!-- Cart Page -->
        <section id="cart" class="page">
             <div class="container mx-auto px-6 py-16">
                <h1 class="text-4xl font-serif text-center text-primary mb-10">Your Shopping Cart {% if not cart_items %}is Empty{% endif %}</h1>
                <div class="flex flex-col lg:flex-row gap-10">
                    {% if not cart_items %}
                    <div class="w-full bg-white p-6 rounded-lg shadow-md">
                        <div class="text-center">
                            <a href="{% url 'store' %}" class="text-primary font-semibold hover:underline">Continue Shopping</a>
                        </div>
                    </div>
                    {% else %}
                    <!-- Cart Items -->
                    <div class="w-full lg:w-2/3 bg-white p-6 rounded-lg shadow-md">
                        <!-- Cart Item loop -->
                        {% for cart_item in cart_items %}
                        <div class="flex items-center border-b pb-4 mb-4">
                            <img src="{{ cart_item.product.images.url }}" alt="{{ cart_item.product.product_name }}" class="w-24 h-30 object-cover rounded-md">
                            <div class="flex-grow ml-4">
                                <a href="{{ cart_item.product.get_url }}" class="font-semibold text-lg">{{ cart_item.product.product_name }}</a>
                                {% if cart_item.variations.all %}
                                    {% for item in cart_item.variations.all %}
                                        <p class="text-sm text-text-light">{{ item.variation_category | capfirst }}: {{ item.variation_value | capfirst }}</p>
                                    {% endfor %}
                                {% endif %}
                                <p class="text-primary font-bold mt-2">₹{{ cart_item.product.price }}</p>
                            </div>
                            <div class="flex items-center border rounded-md mx-4">
                                <a href="{% url 'remove_cart' cart_item.product.id cart_item.id %}" class="px-3 py-1">-</a>
                                <span class="px-3 py-1">{{ cart_item.quantity }}</span>
                                <form action="{% url 'add_cart' cart_item.product.id %}" method="POST">
                                    {% csrf_token %}
                                    {% for item in cart_item.variations.all %}
                                    <input type="hidden" name="{{ item.variation_category | lower }}" value="{{ item.variation_value | capfirst }}">
                                    {% endfor %}
                                    <button type="submit" class="px-3 py-1">+</button>
                                </form>
                            </div>
                            <p class="font-bold w-20 text-right">₹{{ cart_item.sub_total }}</p>
                            <a href="{% url 'remove_cart_item' cart_item.product.id cart_item.id %}" onclick="return confirm('Are you sure you want to delete this item?')" class="ml-4 text-red-500 hover:text-red-700"><i class="fas fa-trash"></i></a>
                        </div>
                        {% endfor %}
                        <div class="text-right mt-6">
                            <a href="{% url 'store' %}" data-page="product_list" class="text-primary font-semibold hover:underline">Continue Shopping</a>
                        </div>
                    </div>
                    <!-- Order Summary -->
                    <div class="w-full lg:w-1/3">
                         <div class="bg-white p-6 rounded-lg shadow-md">
                            <h2 class="text-2xl font-semibold border-b pb-3 mb-4">Order Summary</h2>
                            <div class="flex justify-between mb-2">
                                <span class="text-text-light">Subtotal</span>
                                <span>₹{{ total }}</span>
                            </div>
                            <div class="flex justify-between mb-2">
                                <span class="text-text-light">Shipping</span>
                                <span>₹{{ shipping }}</span>
                            </div>
                            <div class="flex justify-between font-bold text-xl border-t pt-3 mt-3">
                                <span>Total</span>
                                <span>₹{{ grand_total }}</span>
                            </div>
                            <a href="{% url 'checkout' %}" data-page="checkout" class="block text-center bg-primary text-white w-full py-3 mt-6 rounded-md font-semibold hover:bg-opacity-90 transition">Proceed to Checkout</a>
                         </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </section>
    </main>
{% endblock content %}